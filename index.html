<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>æ–¤å…©ç®—éŒ¢</title>

  <!-- ===================== ğŸ”¹ PWA è¨­å®šå€ï¼ˆAPPè¡Œç‚ºè¨­å®šï¼‰ ===================== -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="æ–¤å…©ç®—éŒ¢">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- ===================== ğŸ”¹ ä»‹é¢æ¨£å¼ (UIå€å¡Š) ===================== -->
  <style>
    :root { --pad:14px; --radius:14px; --shadow:0 6px 20px rgba(0,0,0,.08); }
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",Arial;
      background:#f7f7fb;
      color:#222;
      display:grid;
      place-items:start center;
    }
    .app{width:min(720px,100%);padding:24px 16px 40px;box-sizing:border-box}
    .card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin-bottom:16px}
    h1{font-size:22px;margin:6px 0 14px;letter-spacing:.5px;color:#121212}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:14px;color:#555}
    input[type="number"]{
      appearance:none;
      -moz-appearance:textfield;
      padding:12px;
      border-radius:12px;
      border:1px solid #ddd;
      font-size:16px;
      outline:none;
      background:#fafafa;
    }
    input[type="number"]:focus{border-color:#7aa2ff;background:#fff;box-shadow:0 0 0 3px rgba(122,162,255,.15)}
    .hint{color:#888;font-size:12px}
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      border:none;
      background:#222;
      color:#fff;
      font-weight:600;
      font-size:16px;
      padding:12px 16px;
      border-radius:12px;
      cursor:pointer;
      width:100%;
    }
    .btn.secondary{background:#f0f0f3;color:#222}
    .btn:active{transform:translateY(1px)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .result{
      font-variant-numeric:tabular-nums;
      line-height:1.6;
      background:#0f172a;
      color:#e2e8f0;
      border-radius:14px;
      padding:14px;
    }
    .result h3{margin:0 0 8px;font-size:16px;color:#a5b4fc}
    .result p{margin:2px 0}
    .total{font-size:24px;font-weight:800;margin-top:6px}
    footer{text-align:center;color:#888;font-size:12px;margin-top:10px}
  </style>
</head>
<body>

  <!-- ===================== ğŸ”¹ ä¸»ç•«é¢å…§å®¹ (UIå€å¡Š) ===================== -->
  <div class="app">
    <!-- ğŸ§¾ è¼¸å…¥å¡ç‰‡ -->
    <div class="card">
      <h1>æ–¤å…©ç®—éŒ¢</h1>

      <!-- å–®åƒ¹è¼¸å…¥ -->
      <div class="field">
        <label for="price">ä¸€æ–¤å¤šå°‘éŒ¢ï¼ˆå…ƒ / æ–¤ï¼‰</label>
        <input id="price" type="number" inputmode="numeric" min="0" step="1" placeholder="ä¾‹å¦‚ï¼š120" />
      </div>

      <!-- æ–¤èˆ‡å…©è¼¸å…¥ -->
      <div class="row" style="margin-top:10px;">
        <div class="field">
          <label for="jin">å¹¾æ–¤</label>
          <input id="jin" type="number" inputmode="numeric" min="0" step="1" placeholder="ä¾‹å¦‚ï¼š1" />
        </div>
        <div class="field">
          <label for="liang">å¹¾å…©ï¼ˆ0â€“15ï¼‰</label>
          <input id="liang" type="number" inputmode="numeric" min="0" max="15" step="1" placeholder="ä¾‹å¦‚ï¼š8" />
        </div>
      </div>

      <p class="hint">æ›ç®—ï¼š1 æ–¤ = 600 å…‹ï¼›16 å…© = 1 æ–¤</p>

      <!-- æŒ‰éˆ•å€ -->
      <div class="grid2" style="margin-top:12px;">
        <button class="btn" id="btn-calc">è¨ˆç®—</button>
        <button class="btn secondary" id="btn-clear">æ¸…é™¤</button>
      </div>
    </div>

    <!-- ğŸ“Š çµæœé¡¯ç¤ºå¡ç‰‡ -->
    <div class="card">
      <div class="result" id="result" aria-live="polite">
        <h3>çµæœ</h3>
        <p>â€”</p>
      </div>
    </div>

    <footer>å·²æ”¯æ´é›¢ç·šä½¿ç”¨ã€‚å°‡æ­¤é ã€ŒåŠ å…¥ä¸»ç•«é¢ã€å³å¯åƒ App ä¸€æ¨£ä½¿ç”¨ã€‚</footer>
  </div>

  <!-- ===================== ğŸ”¹ è¨ˆç®—é‚è¼¯ (JavaScript å€å¡Š) ===================== -->
<script>
  const $ = (id) => document.getElementById(id);
  const KEY = 'jinliang-app-v1';
  const state = JSON.parse(localStorage.getItem(KEY) || '{}');
  ['price','jin','liang'].forEach(k => { if (state[k] != null) $(k).value = state[k]; });

  function calc() {
    const price = parseInt($("price").value, 10);
    let   jin   = parseInt($("jin").value, 10);
    let   liang = parseInt($("liang").value, 10);

    if (Number.isNaN(price) || Number.isNaN(jin) || Number.isNaN(liang)) {
      show("<p>è«‹å…ˆæŠŠä¸‰å€‹æ¬„ä½éƒ½å¡«ä¸Šæ•¸å­—</p>");
      return;
    }

    let hint = "";
    if (liang > 15) {
      const extraJin = Math.floor(liang / 16);
      liang = liang % 16;
      jin  += extraJin;
      hint = `å·²è‡ªå‹•é€²ä½ï¼š+${extraJin} æ–¤ï¼Œå‰© ${liang} å…©`;
    } else if (liang < 0) {
      liang = 0;
    }

    const gram = jin * 600 + 600 * (liang / 16);
    const jinTotal = jin + (liang / 16);
    const total = Math.round(price * jinTotal); // ç¸½åƒ¹å–æ•´æ•¸

    //å…‹=2ä½ã€æ–¤=4ä½ã€é‡‘é¡=æ•´æ•¸
    const fmt2  = new Intl.NumberFormat('zh-Hant', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const fmt4  = new Intl.NumberFormat('zh-Hant', { minimumFractionDigits: 4, maximumFractionDigits: 4 });
    const money = new Intl.NumberFormat('zh-Hant', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 });

    show(
      `<p>${jin} æ–¤ ${liang} å…© = <strong>${fmt2.format(gram)}</strong> å…‹</p>` +
      `<p>${jin} æ–¤ ${liang} å…© = <strong>${fmt4.format(jinTotal)}</strong> æ–¤</p>` +
      `<p class="total">å…± <strong>${money.format(total)}</strong></p>` +
      (hint ? `<p class="hint">${hint}</p>` : "")
    );

    localStorage.setItem(KEY, JSON.stringify({ price, jin, liang }));
  }

  function show(html) { $("result").innerHTML = `<h3>çµæœ</h3>${html}`; }
  $("btn-calc").addEventListener('click', calc);
  $("btn-clear").addEventListener('click', () => {
    ['price','jin','liang'].forEach(id => $(id).value = '');
    show('<p>â€”</p>');
    localStorage.removeItem(KEY);
  });
  document.addEventListener('keydown', (e) => { if (e.key === 'Enter') calc(); });
  if (['price','jin','liang'].every(id => $(id).value !== '')) calc();

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
  }
  </script>
</body>
</html>

